using System;

namespace _170000Courses
{
    internal class Program
    {
        static void Main(string[] args)
        {

            // 1(  2(  3()3   )2   2()2   )1
            // ( () (()) )
            // ( ( ) ) ( ( ) )

            // инсайд при открытии скобки
            // считать инсайд скобки и общее количество скобок. когда общее количество скобок становится 0 то выходить из инсайд
            // проверять истинность по общему количеству скобок равному нулю
            // считать временную глубину при каждой закрытой скобке, обнулять при выходе из инсайд (нулевом общем количестве скобок), обнулять при нулевом внутреннем количестве скобок
            // если общее количество скобок когда либо падает ниже нуля и в конце не ноль то выражение не корректное

            //прибавлять к счетчику глубины с каждой открывающей
            // один счетчику: + с открывающей - с закрывающей. когда 0 открывать новый счетчик +1. если 0 повторяется больше одного раза (новый счетчик 2 и больше) то высчитывать глубину по самому глубокому
            // по достижению нуля присваивать глубину новой переменной, при достижении нового нуля сравнивать с предыдущим значением переписывать если выше

            //entering inside || counting overall Brackets

            string text;

            int depthTemp = 0;
            int depth = 0;

            int overallBrackets = 0;
            int insideBrackets = 0;
            bool isInside = false;
            bool justEntered = false;
            bool isCorrectExpression = false;
            bool haveOpening = false;

            Console.WriteLine("Enter your bracket expression. I'm waiting");
            text = Console.ReadLine();

            for (int i = 0; i < text.Length; i++)
            {
                switch (text[i])
                {
                    case '(':
                        if (isInside == false)
                        {
                            isInside = true;
                            justEntered = true;
                        }
                        overallBrackets++;
                        break;
                    case ')':
                        overallBrackets--;
                        break;
                }

                //counting inside Brackets
                if (isInside == true && justEntered != true) //here was check on last sym
                {
                    switch (text[i])
                    {
                        case '(':
                            insideBrackets++;
                            haveOpening = true;
                            break;
                        case ')':
                            if (haveOpening == true)
                            {
                                insideBrackets--;
                                depthTemp++;
                            }
                            break;
                    }
                }

                //getting out completely and counting depth
                if (overallBrackets == 0) //here was check on last sym
                {
                    isInside = false;
                    haveOpening = false;
                    if (depthTemp > depth)
                    {
                        depth = depthTemp;
                    }
                    depthTemp = 0;
                }

                //getting out expresion inside and couting depth
                if (justEntered != true && insideBrackets == 0)
                {
                    haveOpening = false;

                    if (depthTemp > depth)
                    {
                        depth = depthTemp;
                    }
                    depthTemp = 0;
                }
                

                justEntered = false;

                //expression is incorrect - break out of cycle
                if (overallBrackets < 0)
                {
                    break;
                }
            }

            if (overallBrackets == 0)
            {
                isCorrectExpression = true;
            }

            if (isCorrectExpression == true)
            {
                Console.ForegroundColor = ConsoleColor.Blue;
                Console.WriteLine(text + " bracket expression is correct");
                Console.ForegroundColor = ConsoleColor.White;
                Console.WriteLine($"{depth + 1} bracket depth");
            }
            else if (isCorrectExpression == false)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine(text + " bracket expression is incorrect");
                Console.ForegroundColor = ConsoleColor.White;
            }

            //testing
            Console.ForegroundColor = ConsoleColor.Yellow;
            Console.WriteLine("\ninside brackets: " + insideBrackets + "\noverall brackets: " + overallBrackets);
            Console.ForegroundColor = ConsoleColor.White;
        }
    }
}
