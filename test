using System;
using System.Collections.Generic;

//Реализовать базу данных игроков и методы для работы с ней.
//У игрока может быть уникальный номер, ник, уровень, флаг – забанен ли он(флаг - bool).
//Реализовать возможность добавления игрока, бана игрока по уникальный номеру,
//разбана игрока по уникальный номеру и удаление игрока.
//Создание самой БД не требуется, задание выполняется инструментами,
//которые вы уже изучили в рамках курса. Но нужен класс, который содержит игроков и её можно назвать "База данных".

namespace CsRealLearning
{
    internal class Program
    {
        public static Random rnd { get; } = new Random();

        static void Main()
        {
            Database dataBase = new Database();
            dataBase.Work();
            dataBase.ShowAllPlayers();
        }

        class Database
        {
            List<Player> players = new List<Player>();
            private int _id;

            public Database()
            {
                _id = 0;
            }

            public void Work()
            {
                while (true)
                {
                    ShowCommands();
                    HandleCommand();

                    Console.ReadKey();
                    Console.Clear();
                }
            }
            enum UserAction
            {
                add_player = 1,
                remove_player_by_id,
                ban_player,
                show_all_players
            }

            private void ShowCommands()
            {
                Console.WriteLine("Select a command:");

                foreach (UserAction command in Enum.GetValues(typeof(UserAction)))
                {
                    Usability.WriteLineInStyle($"{(int)(command)}. {command}", ConsoleColor.Yellow);
                }
            }

            private void HandleCommand()
            {
                if (int.TryParse(Console.ReadLine(), out int userInput))
                {
                    switch (userInput)
                    {
                        case (int)UserAction.add_player:
                            AddPlayer();
                            break;
                        case (int)UserAction.remove_player_by_id:
                            RemovePlayer();
                            break;
                        case (int)UserAction.ban_player:
                            break;
                        case (int)UserAction.show_all_players:
                            Console.Clear();
                            ShowAllPlayers();
                            break;
                        default:
                            Usability.WriteLineInStyle("That's a wrong number. Try again, fool");
                            break;
                    }
                }
                else
                {
                    Usability.WriteLineInStyle("Not a number. I need a number");
                }
            }

            public void AddPlayer()
            {
                string input;

                Console.Clear();
                Console.WriteLine("Enter player name: ");
                input = Console.ReadLine();
                players.Add(new Player(input, _id));
                Usability.WriteLineInStyle($"Player {input} succesfully added", ConsoleColor.Green);
                _id++;
            }

            public void RemovePlayer()
            {
                bool playerFound = false;
                int index = 0;

                Console.Clear();

                if (players.Count == 0)
                {
                    Usability.WriteLineInStyle("The players list is empty", ConsoleColor.Blue);
                }
                else
                {
                    ShowAllPlayers();
                    Console.Write("\nEnter player ID you want to remove: ");

                    if (!int.TryParse(Console.ReadLine(), out int playerInput))
                    {
                        Usability.WriteLineInStyle("Invalid input. Enter a number next time.");
                    }
                    else
                    {
                        while (!playerFound && index < players.Count)
                        {
                            if (players[index].Id == playerInput)
                            {
                                playerFound = true;
                                break;
                            }

                            index++;
                        }

                        if (playerFound)
                        {
                            Usability.WriteLineInStyle($"Player with id {playerInput} (name: {players[playerInput].Name}) succesfully removed", ConsoleColor.Green);
                            players.RemoveAt(index);
                        }
                        else
                        {
                            Usability.WriteLineInStyle($"Player with id {playerInput} not found", ConsoleColor.Red);
                        }
                    }
                }
            }

            public void BanPlayer(int Id)
            {
                // TODO: Implement banning functionality, considering:
                // - Identifying the player to ban (ID, name, etc.)
                // - Updating the player's `IsBanned` status
                // - Providing relevant feedback to the user
                Console.WriteLine("Banning functionality not yet implemented.");
            }

            public void ShowAllPlayers()
            {
                foreach (Player player in players)
                {
                    player.ShowInfo();
                }
            }
        }

        class Player
        {
            public int Id { get; private set; }
            public bool IsBanned { get { return false; } private set { } }
            public string Name { get; private set; }
            public int Level { get { return 1; } private set { } }

            public Player(string name, int id)
            {
                Name = name;

                Id = id;
            }

            public void ShowInfo()
            {
                Console.Write($"Id: {Id}, name: {Name}, level: {Level}, ");

                switch (IsBanned)
                {
                    case true:
                        Console.WriteLine("status: banned");
                        break;
                    case false:
                        Console.WriteLine("status: not banned");
                        break;

                }
            }
        }

        class Usability
        {
            public static void WriteLineInStyle(string style, ConsoleColor color = ConsoleColor.Red)
            {
                Console.ForegroundColor = color;
                Console.WriteLine(style);
                Console.ResetColor();
            }
        }
    }
}
